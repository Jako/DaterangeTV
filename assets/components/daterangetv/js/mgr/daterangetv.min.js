/*!
 * DaterangeTV - Date range custom template variable
 * Version: 1.4.3
 * Build date: 2022-06-17
 */
var daterangeTV=function(t){daterangeTV.superclass.constructor.call(this,t=t||{})};Ext.extend(daterangeTV,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},jquery:{},form:{}}),Ext.reg("daterangetv",daterangeTV),(DaterangeTV=new daterangeTV).combo.TV=function(t){t=t||{},Ext.applyIf(t,{name:"tv",hiddenName:"tv",displayField:"name",valueField:"id",fields:["name","id"],pageSize:20,url:DaterangeTV.config.connectorUrl,baseParams:{action:"mgr/tvs/getlist",combo:!0}}),DaterangeTV.combo.TV.superclass.constructor.call(this,t)},Ext.extend(DaterangeTV.combo.TV,MODx.combo.ComboBox),Ext.reg("daterangetv-combo-tv",DaterangeTV.combo.TV),Ext.apply(Ext.form.VTypes,{daterange:function(t,e){t=e.parseDate(t);if(!t)return!1;var a=Ext.getCmp(e.startDateField),e=Ext.getCmp(e.endDateField);return a&&(a.maxValue&&t.getTime()===a.maxValue.getTime()||(a.setMaxValue(t),a.validate())),e&&(e.minValue&&t.getTime()===e.minValue.getTime()||(e.setMinValue(t),e.validate())),!0}}),DaterangeTV.combo.DaterangeTV=function(t){t=t||{},Ext.applyIf(t,{xtype:"panel",layout:"column",autoHeight:!0,border:!1,width:400,items:[{xtype:"panel",columnWidth:.5,layout:"form",labelAlign:"top",border:!1,items:[new Ext.form.DateField({fieldLabel:_("daterangetv.from"),name:"from"+t.tvId+"[]",id:"from"+t.tvId,format:t.daterangeFormat,dateWidth:200,allowBlank:t.allowBlank,value:t.daterangeStart,msgTarget:"under",vtype:"daterange",labelStyle:"padding-top:4px",endDateField:"to"+t.tvId,listeners:{change:{fn:this.daterangeOnChange,scope:this}}})]},{xtype:"panel",columnWidth:.5,layout:"form",labelAlign:"top",border:!1,items:[new Ext.form.DateField({fieldLabel:_("daterangetv.to"),name:"to"+t.tvId+"[]",id:"to"+t.tvId,format:t.daterangeFormat,dateWidth:200,allowBlank:!0,value:t.daterangeEnd,msgTarget:"under",vtype:"daterange",labelStyle:"padding-top:4px",startDateField:"from"+t.tvId,listeners:{change:{fn:this.daterangeOnChange,scope:this}}})]}]}),DaterangeTV.combo.DaterangeTV.superclass.constructor.call(this,t)},Ext.extend(DaterangeTV.combo.DaterangeTV,MODx.Panel,{daterangeOnChange:function(){var t={from:Ext.getCmp("from"+this.config.tvId,this.config.daterangeFormat).getValue(),to:Ext.getCmp("to"+this.config.tvId,this.config.daterangeFormat).getValue()};this.setTVValue(t)},setTVValue:function(t){var e=this.getTVValue(),a="",n="",r="";t.from&&(r=(a=new Date(t.from).format("Y-m-d"))+"||",t.to&&(r+=n=new Date(t.to).format("Y-m-d"))),this.config.endTV&&Ext.get("tv"+this.config.endTV)?(Ext.get("tv"+this.config.tvId).set({value:a}),Ext.get("tv"+this.config.endTV).set({value:n})):Ext.get("tv"+this.config.tvId).set({value:r}),e!==r&&MODx.fireResourceFormChange()},getTVValue:function(){var t=Ext.get("tv"+this.config.tvId).getValue();return t=this.config.endTV&&Ext.get("tv"+this.config.endTV)&&Ext.get("tv"+this.config.endTV).getValue()?t+"||"+Ext.get("tv"+this.config.endTV).getValue():t}}),Ext.reg("daterangetv-combo-daterangetv",DaterangeTV.combo.DaterangeTV),DaterangeTV.Renderer=function(t){if(!t.length)return"";var t=t.split("||"),e=1<=t.length&&new Date(t[0]),t=2<=t.length&&new Date(t[1]),a=MODx.config["daterangetv.manager_format"].split("|"),n=MODx.config["daterangetv.separator"],r=MODx.config["daterangetv.manager_format"].search(/[djz]/),o=MODx.config["daterangetv.manager_format"].search(/[FmMn]/),g=MODx.config["daterangetv.manager_format"].search(/[oYy]/),i=r<o,o=-1===r||-1===o||-1===g||g<o||g<r,g="";return g=e&&e.getTime()===e.getTime()?t&&t.getTime()===t.getTime()?e.getFullYear()!==t.getFullYear()?Ext.util.Format.date(e,a[0]+a[1]+a[2])+n+Ext.util.Format.date(t,a[0]+a[1]+a[2]):e.getMonth()!==t.getMonth()?o?Ext.util.Format.date(e,a[0]+a[1]+a[2])+n+Ext.util.Format.date(t,a[1]+a[2]):Ext.util.Format.date(e,a[0]+a[1])+n+Ext.util.Format.date(t,a[0]+a[1]+a[2]):e.getDate()!==t.getDate()?o?i?Ext.util.Format.date(e,a[0]+a[1])+n+Ext.util.Format.date(t,a[1]+a[2]):Ext.util.Format.date(e,a[0]+a[1]+a[2])+n+Ext.util.Format.date(t,a[2]):i?Ext.util.Format.date(e,a[0])+n+Ext.util.Format.date(t,a[0]+a[1]+a[2]):Ext.util.Format.date(e,a[0]+a[1])+n+Ext.util.Format.date(t,a[1]+a[2]):Ext.util.Format.date(e,a[0]+a[1]+a[2]):Ext.util.Format.date(e,a[0]+a[1]+a[2]):g};