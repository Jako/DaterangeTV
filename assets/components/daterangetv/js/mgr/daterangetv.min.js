/*!
 * DaterangeTV - Date range custom template variable
 * Version: 1.4.0
 * Build date: 2022-01-13
 */
var daterangeTV=function(t){daterangeTV.superclass.constructor.call(this,t=t||{})};Ext.extend(daterangeTV,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},jquery:{},form:{}}),Ext.reg("daterangetv",daterangeTV),DaterangeTV=new daterangeTV,DaterangeTV.combo.TV=function(t){t=t||{},Ext.applyIf(t,{name:"tv",hiddenName:"tv",displayField:"name",valueField:"id",fields:["name","id"],pageSize:20,url:DaterangeTV.config.connectorUrl,baseParams:{action:"mgr/tvs/getlist",combo:!0}}),DaterangeTV.combo.TV.superclass.constructor.call(this,t)},Ext.extend(DaterangeTV.combo.TV,MODx.combo.ComboBox),Ext.reg("daterangetv-combo-tv",DaterangeTV.combo.TV),Ext.apply(Ext.form.VTypes,{daterange:function(t,e){var a=e.parseDate(t);if(!a)return!1;t=Ext.getCmp(e.startDateField),e=Ext.getCmp(e.endDateField);return t&&(t.maxValue&&a.getTime()===t.maxValue.getTime()||(t.setMaxValue(a),t.validate())),e&&(e.minValue&&a.getTime()===e.minValue.getTime()||(e.setMinValue(a),e.validate())),!0}}),DaterangeTV.combo.DaterangeTV=function(t){t=t||{},Ext.applyIf(t,{xtype:"panel",layout:"column",autoHeight:!0,border:!1,width:400,items:[{xtype:"panel",columnWidth:.5,layout:"form",labelAlign:"top",border:!1,items:[new Ext.form.DateField({fieldLabel:_("daterangetv.from"),name:"from"+t.tvId+"[]",id:"from"+t.tvId,format:t.daterangeFormat,dateWidth:200,allowBlank:t.allowBlank,value:t.daterangeStart,msgTarget:"under",vtype:"daterange",labelStyle:"padding-top:4px",endDateField:"to"+t.tvId,listeners:{change:{fn:this.daterangeOnChange,scope:this}}})]},{xtype:"panel",columnWidth:.5,layout:"form",labelAlign:"top",border:!1,items:[new Ext.form.DateField({fieldLabel:_("daterangetv.to"),name:"to"+t.tvId+"[]",id:"to"+t.tvId,format:t.daterangeFormat,dateWidth:200,allowBlank:!0,value:t.daterangeEnd,msgTarget:"under",vtype:"daterange",labelStyle:"padding-top:4px",startDateField:"from"+t.tvId,listeners:{change:{fn:this.daterangeOnChange,scope:this}}})]}]}),DaterangeTV.combo.DaterangeTV.superclass.constructor.call(this,t)},Ext.extend(DaterangeTV.combo.DaterangeTV,MODx.Panel,{daterangeOnChange:function(){var t={from:Ext.getCmp("from"+this.config.tvId,this.config.daterangeFormat).getValue(),to:Ext.getCmp("to"+this.config.tvId,this.config.daterangeFormat).getValue()};this.setTVValue(t)},setTVValue:function(t){var e=this.getTVValue(),a="",n="",r="";t.from&&(r=(a=new Date(t.from).format("Y-m-d"))+"||",t.to&&(r+=n=new Date(t.to).format("Y-m-d"))),this.config.endTV&&Ext.get("tv"+this.config.endTV)?(Ext.get("tv"+this.config.tvId).set({value:a}),Ext.get("tv"+this.config.endTV).set({value:n})):Ext.get("tv"+this.config.tvId).set({value:r}),e!==r&&MODx.fireResourceFormChange()},getTVValue:function(){var t=Ext.get("tv"+this.config.tvId).getValue();return t=this.config.endTV&&Ext.get("tv"+this.config.endTV)&&Ext.get("tv"+this.config.endTV).getValue()?t+"||"+Ext.get("tv"+this.config.endTV).getValue():t}}),Ext.reg("daterangetv-combo-daterangetv",DaterangeTV.combo.DaterangeTV),DaterangeTV.Renderer=function(t){if(!t.length)return"";var e=t.split("||"),a=1<=e.length&&new Date(e[0]),n=2<=e.length&&new Date(e[1]),r=MODx.config["daterangetv.manager_format"].split("|"),o=MODx.config["daterangetv.separator"],g=MODx.config["daterangetv.manager_format"].search(/[djz]/),i=MODx.config["daterangetv.manager_format"].search(/[FmMn]/),t=MODx.config["daterangetv.manager_format"].search(/[oYy]/),e=g<i,t=-1===g||-1===i||-1===t||t<i||t<g,g="";return g=a&&a.getTime()===a.getTime()?n&&n.getTime()===n.getTime()?a.getFullYear()!==n.getFullYear()?Ext.util.Format.date(a,r[0]+r[1]+r[2])+o+Ext.util.Format.date(n,r[0]+r[1]+r[2]):a.getMonth()!==n.getMonth()?t?Ext.util.Format.date(a,r[0]+r[1]+r[2])+o+Ext.util.Format.date(n,r[1]+r[2]):Ext.util.Format.date(a,r[0]+r[1])+o+Ext.util.Format.date(n,r[0]+r[1]+r[2]):a.getDate()!==n.getDate()?t?e?Ext.util.Format.date(a,r[0]+r[1])+o+Ext.util.Format.date(n,r[1]+r[2]):Ext.util.Format.date(a,r[0]+r[1]+r[2])+o+Ext.util.Format.date(n,r[2]):e?Ext.util.Format.date(a,r[0])+o+Ext.util.Format.date(n,r[0]+r[1]+r[2]):Ext.util.Format.date(a,r[0]+r[1])+o+Ext.util.Format.date(n,r[1]+r[2]):Ext.util.Format.date(a,r[0]+r[1]+r[2]):Ext.util.Format.date(a,r[0]+r[1]+r[2]):g};